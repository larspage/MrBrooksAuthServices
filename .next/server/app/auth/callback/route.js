"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/auth/callback/route";
exports.ids = ["app/auth/callback/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fauth%2Fcallback%2Froute&page=%2Fauth%2Fcallback%2Froute&appPaths=&pagePath=private-next-app-dir%2Fauth%2Fcallback%2Froute.ts&appDir=C%3A%5CRepos%5CMrBrooksAuthServices%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CRepos%5CMrBrooksAuthServices&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fauth%2Fcallback%2Froute&page=%2Fauth%2Fcallback%2Froute&appPaths=&pagePath=private-next-app-dir%2Fauth%2Fcallback%2Froute.ts&appDir=C%3A%5CRepos%5CMrBrooksAuthServices%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CRepos%5CMrBrooksAuthServices&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Repos_MrBrooksAuthServices_src_app_auth_callback_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/auth/callback/route.ts */ \"(rsc)/./src/app/auth/callback/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/auth/callback/route\",\n        pathname: \"/auth/callback\",\n        filename: \"route\",\n        bundlePath: \"app/auth/callback/route\"\n    },\n    resolvedPagePath: \"C:\\\\Repos\\\\MrBrooksAuthServices\\\\src\\\\app\\\\auth\\\\callback\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Repos_MrBrooksAuthServices_src_app_auth_callback_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/auth/callback/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhdXRoJTJGY2FsbGJhY2slMkZyb3V0ZSZwYWdlPSUyRmF1dGglMkZjYWxsYmFjayUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmF1dGglMkZjYWxsYmFjayUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDUmVwb3MlNUNNckJyb29rc0F1dGhTZXJ2aWNlcyU1Q3NyYyU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1JlcG9zJTVDTXJCcm9va3NBdXRoU2VydmljZXMmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ21CO0FBQ2hHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXJicm9va3MtYXV0aC1zZXJ2aWNlLz8xMDlmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkM6XFxcXFJlcG9zXFxcXE1yQnJvb2tzQXV0aFNlcnZpY2VzXFxcXHNyY1xcXFxhcHBcXFxcYXV0aFxcXFxjYWxsYmFja1xcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hdXRoL2NhbGxiYWNrL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hdXRoL2NhbGxiYWNrXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2F1dGgvY2FsbGJhY2svcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxSZXBvc1xcXFxNckJyb29rc0F1dGhTZXJ2aWNlc1xcXFxzcmNcXFxcYXBwXFxcXGF1dGhcXFxcY2FsbGJhY2tcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXV0aC9jYWxsYmFjay9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fauth%2Fcallback%2Froute&page=%2Fauth%2Fcallback%2Froute&appPaths=&pagePath=private-next-app-dir%2Fauth%2Fcallback%2Froute.ts&appDir=C%3A%5CRepos%5CMrBrooksAuthServices%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CRepos%5CMrBrooksAuthServices&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/auth/callback/route.ts":
/*!****************************************!*\
  !*** ./src/app/auth/callback/route.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n\nasync function GET(request) {\n    const { searchParams, origin, hash } = new URL(request.url);\n    const code = searchParams.get(\"code\");\n    const sessionToken = searchParams.get(\"session\");\n    const next = searchParams.get(\"next\") ?? \"/\";\n    // Check for error parameters that might come from Supabase\n    const error = searchParams.get(\"error\");\n    const errorCode = searchParams.get(\"error_code\");\n    const errorDescription = searchParams.get(\"error_description\");\n    // Check for tokens in URL fragment (when Supabase doesn't use our callback)\n    const accessToken = searchParams.get(\"access_token\");\n    const refreshToken = searchParams.get(\"refresh_token\");\n    const tokenType = searchParams.get(\"token_type\");\n    const expiresAt = searchParams.get(\"expires_at\");\n    const type = searchParams.get(\"type\");\n    console.log(\"\\uD83D\\uDD04 Auth callback received:\");\n    console.log(\"\\uD83D\\uDD04 Full URL:\", request.url);\n    console.log(\"\\uD83D\\uDD04 Code:\", code ? \"present\" : \"missing\");\n    console.log(\"\\uD83D\\uDD04 Session token:\", sessionToken ? `present (${sessionToken.length} chars)` : \"missing\");\n    console.log(\"\\uD83D\\uDD04 Next:\", next);\n    console.log(\"\\uD83D\\uDD04 Error:\", error || \"none\");\n    console.log(\"\\uD83D\\uDD04 Error code:\", errorCode || \"none\");\n    console.log(\"\\uD83D\\uDD04 Error description:\", errorDescription || \"none\");\n    // Handle tokens passed in URL parameters (alternative flow)\n    console.log(\"\\uD83D\\uDD04 Alternative token flow:\");\n    console.log(\"\\uD83D\\uDD04 Access token:\", accessToken ? \"present\" : \"missing\");\n    console.log(\"\\uD83D\\uDD04 Refresh token:\", refreshToken ? \"present\" : \"missing\");\n    console.log(\"\\uD83D\\uDD04 Token type:\", tokenType || \"none\");\n    console.log(\"\\uD83D\\uDD04 Expires at:\", expiresAt || \"none\");\n    console.log(\"\\uD83D\\uDD04 Type:\", type || \"none\");\n    // Handle errors from Supabase (like expired tokens)\n    if (error) {\n        console.error(\"\\uD83D\\uDD04 Supabase error in callback:\", {\n            error,\n            errorCode,\n            errorDescription\n        });\n        if (errorCode === \"otp_expired\") {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(`${origin}/auth/auth-code-error?error=expired&message=${encodeURIComponent(\"Email confirmation link has expired. Please request a new one.\")}`);\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(`${origin}/auth/auth-code-error?error=${error}&message=${encodeURIComponent(errorDescription || \"Authentication error occurred\")}`);\n    }\n    // Handle direct token flow (when Supabase doesn't use our callback properly)\n    if (accessToken && refreshToken && type === \"signup\") {\n        console.log(\"\\uD83D\\uDD04 Handling direct token flow - Supabase bypassed our callback\");\n        try {\n            // Create a server-side Supabase client\n            const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(\"https://tiylfbpezoetzccylgeb.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRpeWxmYnBlem9ldHpjY3lsZ2ViIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4MjcwODcsImV4cCI6MjA3MjQwMzA4N30._qQeucCOqhKOlPVugKy_bQ91yx3nGfT4k6415pXnzKc\");\n            // Set the session using the tokens provided\n            const { data, error: sessionError } = await supabase.auth.setSession({\n                access_token: accessToken,\n                refresh_token: refreshToken\n            });\n            console.log(\"\\uD83D\\uDD04 Direct token session result:\", {\n                hasData: !!data,\n                hasSession: !!data?.session,\n                hasUser: !!data?.user,\n                sessionError: sessionError ? {\n                    message: sessionError.message,\n                    status: sessionError.status\n                } : null\n            });\n            if (sessionError) {\n                console.error(\"\\uD83D\\uDD04 Error setting session from direct tokens:\", sessionError);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(`${origin}/auth/auth-code-error?error=session_failed&message=${encodeURIComponent(\"Failed to establish session from tokens\")}`);\n            }\n            if (data.session) {\n                console.log(\"✅ Successfully authenticated user via direct tokens:\", data.user?.email);\n                // Create user profile if it doesn't exist\n                if (data.user) {\n                    const { error: profileError } = await supabase.from(\"user_profiles\").upsert({\n                        id: data.user.id,\n                        email: data.user.email || null,\n                        full_name: data.user.user_metadata?.full_name || null,\n                        updated_at: new Date().toISOString()\n                    }, {\n                        onConflict: \"id\"\n                    });\n                    if (profileError) {\n                        console.error(\"Error creating/updating user profile:\", profileError);\n                    }\n                }\n                // Check if this is part of a cross-application authentication flow\n                if (sessionToken && data.user) {\n                    try {\n                        // Complete the auth session and get redirect information\n                        const { data: sessionData, error: sessionError } = await supabase.rpc(\"complete_auth_session\", {\n                            session_token: sessionToken,\n                            authenticated_user_id: data.user.id\n                        });\n                        if (!sessionError && sessionData && sessionData.length > 0) {\n                            const { redirect_url, state } = sessionData[0];\n                            console.log(\"\\uD83C\\uDFAF Retrieved redirect_url from session:\", redirect_url);\n                            console.log(\"\\uD83C\\uDFAF redirect_url length:\", redirect_url.length);\n                            // Build the redirect URL with success parameters\n                            const redirectUrl = new URL(redirect_url);\n                            console.log(\"\\uD83D\\uDD17 Base redirectUrl created:\", redirectUrl.toString());\n                            redirectUrl.searchParams.set(\"auth_success\", \"true\");\n                            if (data.user) {\n                                redirectUrl.searchParams.set(\"user_id\", data.user.id);\n                            }\n                            console.log(\"\\uD83D\\uDD17 After adding auth_success and user_id:\", redirectUrl.toString());\n                            console.log(\"\\uD83D\\uDD17 Current length:\", redirectUrl.toString().length);\n                            if (state) {\n                                console.log(\"\\uD83C\\uDFAF Adding state:\", JSON.stringify(state));\n                                console.log(\"\\uD83C\\uDFAF State length:\", JSON.stringify(state).length);\n                                redirectUrl.searchParams.set(\"state\", JSON.stringify(state));\n                                console.log(\"\\uD83D\\uDD17 After adding state:\", redirectUrl.toString());\n                                console.log(\"\\uD83D\\uDD17 Final length:\", redirectUrl.toString().length);\n                                // Check for potential URL length issues\n                                if (redirectUrl.toString().length > 2048) {\n                                    console.warn(\"⚠️ WARNING: Final redirectUrl exceeds 2048 characters, may cause issues with some browsers/email clients\");\n                                }\n                                if (redirectUrl.toString().length > 8192) {\n                                    console.error(\"❌ ERROR: Final redirectUrl exceeds 8192 characters, likely to cause failures\");\n                                }\n                            }\n                            console.log(\"\\uD83D\\uDE80 Final redirect URL (direct tokens):\", redirectUrl.toString());\n                            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(redirectUrl.toString());\n                        } else {\n                            console.error(\"Error completing auth session:\", sessionError);\n                        }\n                    } catch (sessionError) {\n                        console.error(\"Error processing auth session:\", sessionError);\n                    }\n                }\n                // Default redirect to the next URL or home page\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(`${origin}${next}`);\n            }\n        } catch (error) {\n            console.error(\"Unexpected error in direct token flow:\", error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(`${origin}/auth/auth-code-error`);\n        }\n    }\n    if (code) {\n        try {\n            console.log(\"\\uD83D\\uDD04 Processing auth code:\", code.substring(0, 10) + \"...\");\n            console.log(\"\\uD83D\\uDD04 Server time:\", new Date().toISOString());\n            // Create a server-side Supabase client\n            const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(\"https://tiylfbpezoetzccylgeb.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRpeWxmYnBlem9ldHpjY3lsZ2ViIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4MjcwODcsImV4cCI6MjA3MjQwMzA4N30._qQeucCOqhKOlPVugKy_bQ91yx3nGfT4k6415pXnzKc\");\n            // Exchange the code for a session\n            console.log(\"\\uD83D\\uDD04 Attempting to exchange code for session...\");\n            const { data, error } = await supabase.auth.exchangeCodeForSession(code);\n            console.log(\"\\uD83D\\uDD04 Exchange result:\", {\n                hasData: !!data,\n                hasSession: !!data?.session,\n                hasUser: !!data?.user,\n                error: error ? {\n                    message: error.message,\n                    status: error.status,\n                    name: error.name\n                } : null\n            });\n            if (error) {\n                console.error(\"\\uD83D\\uDD04 Detailed error exchanging code for session:\", {\n                    message: error.message,\n                    status: error.status,\n                    name: error.name,\n                    stack: error.stack\n                });\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(`${origin}/auth/auth-code-error?error=exchange_failed&message=${encodeURIComponent(error.message)}`);\n            }\n            if (data.session) {\n                console.log(\"Successfully authenticated user:\", data.user?.email);\n                // Create user profile if it doesn't exist\n                if (data.user) {\n                    const { error: profileError } = await supabase.from(\"user_profiles\").upsert({\n                        id: data.user.id,\n                        email: data.user.email || null,\n                        full_name: data.user.user_metadata?.full_name || null,\n                        updated_at: new Date().toISOString()\n                    }, {\n                        onConflict: \"id\"\n                    });\n                    if (profileError) {\n                        console.error(\"Error creating/updating user profile:\", profileError);\n                    }\n                }\n                // Check if this is part of a cross-application authentication flow\n                if (sessionToken) {\n                    try {\n                        // Complete the auth session and get redirect information\n                        const { data: sessionData, error: sessionError } = await supabase.rpc(\"complete_auth_session\", {\n                            session_token: sessionToken,\n                            authenticated_user_id: data.user.id\n                        });\n                        if (!sessionError && sessionData && sessionData.length > 0) {\n                            const { redirect_url, state } = sessionData[0];\n                            console.log(\"\\uD83C\\uDFAF Retrieved redirect_url from session:\", redirect_url);\n                            console.log(\"\\uD83C\\uDFAF redirect_url length:\", redirect_url.length);\n                            // Build the redirect URL with success parameters\n                            const redirectUrl = new URL(redirect_url);\n                            console.log(\"\\uD83D\\uDD17 Base redirectUrl created:\", redirectUrl.toString());\n                            redirectUrl.searchParams.set(\"auth_success\", \"true\");\n                            redirectUrl.searchParams.set(\"user_id\", data.user.id);\n                            console.log(\"\\uD83D\\uDD17 After adding auth_success and user_id:\", redirectUrl.toString());\n                            console.log(\"\\uD83D\\uDD17 Current length:\", redirectUrl.toString().length);\n                            if (state) {\n                                console.log(\"\\uD83C\\uDFAF Adding state:\", JSON.stringify(state));\n                                console.log(\"\\uD83C\\uDFAF State length:\", JSON.stringify(state).length);\n                                redirectUrl.searchParams.set(\"state\", JSON.stringify(state));\n                                console.log(\"\\uD83D\\uDD17 After adding state:\", redirectUrl.toString());\n                                console.log(\"\\uD83D\\uDD17 Final length:\", redirectUrl.toString().length);\n                                // Check for potential URL length issues\n                                if (redirectUrl.toString().length > 2048) {\n                                    console.warn(\"⚠️ WARNING: Final redirectUrl exceeds 2048 characters, may cause issues with some browsers/email clients\");\n                                }\n                                if (redirectUrl.toString().length > 8192) {\n                                    console.error(\"❌ ERROR: Final redirectUrl exceeds 8192 characters, likely to cause failures\");\n                                }\n                            }\n                            console.log(\"\\uD83D\\uDE80 Final redirect URL:\", redirectUrl.toString());\n                            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(redirectUrl.toString());\n                        } else {\n                            console.error(\"Error completing auth session:\", sessionError);\n                        }\n                    } catch (sessionError) {\n                        console.error(\"Error processing auth session:\", sessionError);\n                    }\n                }\n                // Default redirect to the next URL or home page\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(`${origin}${next}`);\n            }\n        } catch (error) {\n            console.error(\"Unexpected error in auth callback:\", error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(`${origin}/auth/auth-code-error`);\n        }\n    }\n    // If no code, redirect to home\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(`${origin}/`);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Ly4vc3JjL2FwcC9hdXRoL2NhbGxiYWNrL3JvdXRlLnRzP2IyOWEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnXHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgY29uc3QgeyBzZWFyY2hQYXJhbXMsIG9yaWdpbiwgaGFzaCB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybClcclxuICBjb25zdCBjb2RlID0gc2VhcmNoUGFyYW1zLmdldCgnY29kZScpXHJcbiAgY29uc3Qgc2Vzc2lvblRva2VuID0gc2VhcmNoUGFyYW1zLmdldCgnc2Vzc2lvbicpXHJcbiAgY29uc3QgbmV4dCA9IHNlYXJjaFBhcmFtcy5nZXQoJ25leHQnKSA/PyAnLydcclxuXHJcbiAgLy8gQ2hlY2sgZm9yIGVycm9yIHBhcmFtZXRlcnMgdGhhdCBtaWdodCBjb21lIGZyb20gU3VwYWJhc2VcclxuICBjb25zdCBlcnJvciA9IHNlYXJjaFBhcmFtcy5nZXQoJ2Vycm9yJylcclxuICBjb25zdCBlcnJvckNvZGUgPSBzZWFyY2hQYXJhbXMuZ2V0KCdlcnJvcl9jb2RlJylcclxuICBjb25zdCBlcnJvckRlc2NyaXB0aW9uID0gc2VhcmNoUGFyYW1zLmdldCgnZXJyb3JfZGVzY3JpcHRpb24nKVxyXG5cclxuICAvLyBDaGVjayBmb3IgdG9rZW5zIGluIFVSTCBmcmFnbWVudCAod2hlbiBTdXBhYmFzZSBkb2Vzbid0IHVzZSBvdXIgY2FsbGJhY2spXHJcbiAgY29uc3QgYWNjZXNzVG9rZW4gPSBzZWFyY2hQYXJhbXMuZ2V0KCdhY2Nlc3NfdG9rZW4nKVxyXG4gIGNvbnN0IHJlZnJlc2hUb2tlbiA9IHNlYXJjaFBhcmFtcy5nZXQoJ3JlZnJlc2hfdG9rZW4nKVxyXG4gIGNvbnN0IHRva2VuVHlwZSA9IHNlYXJjaFBhcmFtcy5nZXQoJ3Rva2VuX3R5cGUnKVxyXG4gIGNvbnN0IGV4cGlyZXNBdCA9IHNlYXJjaFBhcmFtcy5nZXQoJ2V4cGlyZXNfYXQnKVxyXG4gIGNvbnN0IHR5cGUgPSBzZWFyY2hQYXJhbXMuZ2V0KCd0eXBlJylcclxuXHJcbiAgY29uc29sZS5sb2coJ/CflIQgQXV0aCBjYWxsYmFjayByZWNlaXZlZDonKVxyXG4gIGNvbnNvbGUubG9nKCfwn5SEIEZ1bGwgVVJMOicsIHJlcXVlc3QudXJsKVxyXG4gIGNvbnNvbGUubG9nKCfwn5SEIENvZGU6JywgY29kZSA/ICdwcmVzZW50JyA6ICdtaXNzaW5nJylcclxuICBjb25zb2xlLmxvZygn8J+UhCBTZXNzaW9uIHRva2VuOicsIHNlc3Npb25Ub2tlbiA/IGBwcmVzZW50ICgke3Nlc3Npb25Ub2tlbi5sZW5ndGh9IGNoYXJzKWAgOiAnbWlzc2luZycpXHJcbiAgY29uc29sZS5sb2coJ/CflIQgTmV4dDonLCBuZXh0KVxyXG4gIGNvbnNvbGUubG9nKCfwn5SEIEVycm9yOicsIGVycm9yIHx8ICdub25lJylcclxuICBjb25zb2xlLmxvZygn8J+UhCBFcnJvciBjb2RlOicsIGVycm9yQ29kZSB8fCAnbm9uZScpXHJcbiAgY29uc29sZS5sb2coJ/CflIQgRXJyb3IgZGVzY3JpcHRpb246JywgZXJyb3JEZXNjcmlwdGlvbiB8fCAnbm9uZScpXHJcblxyXG4gIC8vIEhhbmRsZSB0b2tlbnMgcGFzc2VkIGluIFVSTCBwYXJhbWV0ZXJzIChhbHRlcm5hdGl2ZSBmbG93KVxyXG4gIGNvbnNvbGUubG9nKCfwn5SEIEFsdGVybmF0aXZlIHRva2VuIGZsb3c6JylcclxuICBjb25zb2xlLmxvZygn8J+UhCBBY2Nlc3MgdG9rZW46JywgYWNjZXNzVG9rZW4gPyAncHJlc2VudCcgOiAnbWlzc2luZycpXHJcbiAgY29uc29sZS5sb2coJ/CflIQgUmVmcmVzaCB0b2tlbjonLCByZWZyZXNoVG9rZW4gPyAncHJlc2VudCcgOiAnbWlzc2luZycpXHJcbiAgY29uc29sZS5sb2coJ/CflIQgVG9rZW4gdHlwZTonLCB0b2tlblR5cGUgfHwgJ25vbmUnKVxyXG4gIGNvbnNvbGUubG9nKCfwn5SEIEV4cGlyZXMgYXQ6JywgZXhwaXJlc0F0IHx8ICdub25lJylcclxuICBjb25zb2xlLmxvZygn8J+UhCBUeXBlOicsIHR5cGUgfHwgJ25vbmUnKVxyXG5cclxuICAvLyBIYW5kbGUgZXJyb3JzIGZyb20gU3VwYWJhc2UgKGxpa2UgZXhwaXJlZCB0b2tlbnMpXHJcbiAgaWYgKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCfwn5SEIFN1cGFiYXNlIGVycm9yIGluIGNhbGxiYWNrOicsIHsgZXJyb3IsIGVycm9yQ29kZSwgZXJyb3JEZXNjcmlwdGlvbiB9KVxyXG5cclxuICAgIGlmIChlcnJvckNvZGUgPT09ICdvdHBfZXhwaXJlZCcpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChgJHtvcmlnaW59L2F1dGgvYXV0aC1jb2RlLWVycm9yP2Vycm9yPWV4cGlyZWQmbWVzc2FnZT0ke2VuY29kZVVSSUNvbXBvbmVudCgnRW1haWwgY29uZmlybWF0aW9uIGxpbmsgaGFzIGV4cGlyZWQuIFBsZWFzZSByZXF1ZXN0IGEgbmV3IG9uZS4nKX1gKVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QoYCR7b3JpZ2lufS9hdXRoL2F1dGgtY29kZS1lcnJvcj9lcnJvcj0ke2Vycm9yfSZtZXNzYWdlPSR7ZW5jb2RlVVJJQ29tcG9uZW50KGVycm9yRGVzY3JpcHRpb24gfHwgJ0F1dGhlbnRpY2F0aW9uIGVycm9yIG9jY3VycmVkJyl9YClcclxuICB9XHJcblxyXG4gIC8vIEhhbmRsZSBkaXJlY3QgdG9rZW4gZmxvdyAod2hlbiBTdXBhYmFzZSBkb2Vzbid0IHVzZSBvdXIgY2FsbGJhY2sgcHJvcGVybHkpXHJcbiAgaWYgKGFjY2Vzc1Rva2VuICYmIHJlZnJlc2hUb2tlbiAmJiB0eXBlID09PSAnc2lnbnVwJykge1xyXG4gICAgY29uc29sZS5sb2coJ/CflIQgSGFuZGxpbmcgZGlyZWN0IHRva2VuIGZsb3cgLSBTdXBhYmFzZSBieXBhc3NlZCBvdXIgY2FsbGJhY2snKVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIENyZWF0ZSBhIHNlcnZlci1zaWRlIFN1cGFiYXNlIGNsaWVudFxyXG4gICAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChcclxuICAgICAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhLFxyXG4gICAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIVxyXG4gICAgICApXHJcblxyXG4gICAgICAvLyBTZXQgdGhlIHNlc3Npb24gdXNpbmcgdGhlIHRva2VucyBwcm92aWRlZFxyXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yOiBzZXNzaW9uRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2V0U2Vzc2lvbih7XHJcbiAgICAgICAgYWNjZXNzX3Rva2VuOiBhY2Nlc3NUb2tlbixcclxuICAgICAgICByZWZyZXNoX3Rva2VuOiByZWZyZXNoVG9rZW5cclxuICAgICAgfSlcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SEIERpcmVjdCB0b2tlbiBzZXNzaW9uIHJlc3VsdDonLCB7XHJcbiAgICAgICAgaGFzRGF0YTogISFkYXRhLFxyXG4gICAgICAgIGhhc1Nlc3Npb246ICEhZGF0YT8uc2Vzc2lvbixcclxuICAgICAgICBoYXNVc2VyOiAhIWRhdGE/LnVzZXIsXHJcbiAgICAgICAgc2Vzc2lvbkVycm9yOiBzZXNzaW9uRXJyb3IgPyB7XHJcbiAgICAgICAgICBtZXNzYWdlOiBzZXNzaW9uRXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIHN0YXR1czogc2Vzc2lvbkVycm9yLnN0YXR1c1xyXG4gICAgICAgIH0gOiBudWxsXHJcbiAgICAgIH0pXHJcblxyXG4gICAgICBpZiAoc2Vzc2lvbkVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcign8J+UhCBFcnJvciBzZXR0aW5nIHNlc3Npb24gZnJvbSBkaXJlY3QgdG9rZW5zOicsIHNlc3Npb25FcnJvcilcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KGAke29yaWdpbn0vYXV0aC9hdXRoLWNvZGUtZXJyb3I/ZXJyb3I9c2Vzc2lvbl9mYWlsZWQmbWVzc2FnZT0ke2VuY29kZVVSSUNvbXBvbmVudCgnRmFpbGVkIHRvIGVzdGFibGlzaCBzZXNzaW9uIGZyb20gdG9rZW5zJyl9YClcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGRhdGEuc2Vzc2lvbikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCfinIUgU3VjY2Vzc2Z1bGx5IGF1dGhlbnRpY2F0ZWQgdXNlciB2aWEgZGlyZWN0IHRva2VuczonLCBkYXRhLnVzZXI/LmVtYWlsKVxyXG5cclxuICAgICAgICAvLyBDcmVhdGUgdXNlciBwcm9maWxlIGlmIGl0IGRvZXNuJ3QgZXhpc3RcclxuICAgICAgICBpZiAoZGF0YS51c2VyKSB7XHJcbiAgICAgICAgICBjb25zdCB7IGVycm9yOiBwcm9maWxlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcclxuICAgICAgICAgICAgLnVwc2VydCh7XHJcbiAgICAgICAgICAgICAgaWQ6IGRhdGEudXNlci5pZCxcclxuICAgICAgICAgICAgICBlbWFpbDogZGF0YS51c2VyLmVtYWlsIHx8IG51bGwsXHJcbiAgICAgICAgICAgICAgZnVsbF9uYW1lOiBkYXRhLnVzZXIudXNlcl9tZXRhZGF0YT8uZnVsbF9uYW1lIHx8IG51bGwsXHJcbiAgICAgICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICBvbkNvbmZsaWN0OiAnaWQnXHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgaWYgKHByb2ZpbGVFcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZy91cGRhdGluZyB1c2VyIHByb2ZpbGU6JywgcHJvZmlsZUVycm9yKVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBwYXJ0IG9mIGEgY3Jvc3MtYXBwbGljYXRpb24gYXV0aGVudGljYXRpb24gZmxvd1xyXG4gICAgICAgIGlmIChzZXNzaW9uVG9rZW4gJiYgZGF0YS51c2VyKSB7XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvLyBDb21wbGV0ZSB0aGUgYXV0aCBzZXNzaW9uIGFuZCBnZXQgcmVkaXJlY3QgaW5mb3JtYXRpb25cclxuICAgICAgICAgICAgY29uc3QgeyBkYXRhOiBzZXNzaW9uRGF0YSwgZXJyb3I6IHNlc3Npb25FcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UucnBjKCdjb21wbGV0ZV9hdXRoX3Nlc3Npb24nLCB7XHJcbiAgICAgICAgICAgICAgc2Vzc2lvbl90b2tlbjogc2Vzc2lvblRva2VuLFxyXG4gICAgICAgICAgICAgIGF1dGhlbnRpY2F0ZWRfdXNlcl9pZDogZGF0YS51c2VyLmlkXHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICBpZiAoIXNlc3Npb25FcnJvciAmJiBzZXNzaW9uRGF0YSAmJiBzZXNzaW9uRGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgY29uc3QgeyByZWRpcmVjdF91cmwsIHN0YXRlIH0gPSBzZXNzaW9uRGF0YVswXVxyXG5cclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+OryBSZXRyaWV2ZWQgcmVkaXJlY3RfdXJsIGZyb20gc2Vzc2lvbjonLCByZWRpcmVjdF91cmwpXHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/Cfjq8gcmVkaXJlY3RfdXJsIGxlbmd0aDonLCByZWRpcmVjdF91cmwubGVuZ3RoKVxyXG5cclxuICAgICAgICAgICAgICAvLyBCdWlsZCB0aGUgcmVkaXJlY3QgVVJMIHdpdGggc3VjY2VzcyBwYXJhbWV0ZXJzXHJcbiAgICAgICAgICAgICAgY29uc3QgcmVkaXJlY3RVcmwgPSBuZXcgVVJMKHJlZGlyZWN0X3VybClcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+UlyBCYXNlIHJlZGlyZWN0VXJsIGNyZWF0ZWQ6JywgcmVkaXJlY3RVcmwudG9TdHJpbmcoKSlcclxuXHJcbiAgICAgICAgICAgICAgcmVkaXJlY3RVcmwuc2VhcmNoUGFyYW1zLnNldCgnYXV0aF9zdWNjZXNzJywgJ3RydWUnKVxyXG4gICAgICAgICAgICAgIGlmIChkYXRhLnVzZXIpIHtcclxuICAgICAgICAgICAgICAgIHJlZGlyZWN0VXJsLnNlYXJjaFBhcmFtcy5zZXQoJ3VzZXJfaWQnLCBkYXRhLnVzZXIuaWQpXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5SXIEFmdGVyIGFkZGluZyBhdXRoX3N1Y2Nlc3MgYW5kIHVzZXJfaWQ6JywgcmVkaXJlY3RVcmwudG9TdHJpbmcoKSlcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+UlyBDdXJyZW50IGxlbmd0aDonLCByZWRpcmVjdFVybC50b1N0cmluZygpLmxlbmd0aClcclxuXHJcbiAgICAgICAgICAgICAgaWYgKHN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+OryBBZGRpbmcgc3RhdGU6JywgSlNPTi5zdHJpbmdpZnkoc3RhdGUpKVxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/Cfjq8gU3RhdGUgbGVuZ3RoOicsIEpTT04uc3RyaW5naWZ5KHN0YXRlKS5sZW5ndGgpXHJcbiAgICAgICAgICAgICAgICByZWRpcmVjdFVybC5zZWFyY2hQYXJhbXMuc2V0KCdzdGF0ZScsIEpTT04uc3RyaW5naWZ5KHN0YXRlKSlcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5SXIEFmdGVyIGFkZGluZyBzdGF0ZTonLCByZWRpcmVjdFVybC50b1N0cmluZygpKVxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/CflJcgRmluYWwgbGVuZ3RoOicsIHJlZGlyZWN0VXJsLnRvU3RyaW5nKCkubGVuZ3RoKVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIENoZWNrIGZvciBwb3RlbnRpYWwgVVJMIGxlbmd0aCBpc3N1ZXNcclxuICAgICAgICAgICAgICAgIGlmIChyZWRpcmVjdFVybC50b1N0cmluZygpLmxlbmd0aCA+IDIwNDgpIHtcclxuICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gV0FSTklORzogRmluYWwgcmVkaXJlY3RVcmwgZXhjZWVkcyAyMDQ4IGNoYXJhY3RlcnMsIG1heSBjYXVzZSBpc3N1ZXMgd2l0aCBzb21lIGJyb3dzZXJzL2VtYWlsIGNsaWVudHMnKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHJlZGlyZWN0VXJsLnRvU3RyaW5nKCkubGVuZ3RoID4gODE5Mikge1xyXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRVJST1I6IEZpbmFsIHJlZGlyZWN0VXJsIGV4Y2VlZHMgODE5MiBjaGFyYWN0ZXJzLCBsaWtlbHkgdG8gY2F1c2UgZmFpbHVyZXMnKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/CfmoAgRmluYWwgcmVkaXJlY3QgVVJMIChkaXJlY3QgdG9rZW5zKTonLCByZWRpcmVjdFVybC50b1N0cmluZygpKVxyXG4gICAgICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QocmVkaXJlY3RVcmwudG9TdHJpbmcoKSlcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjb21wbGV0aW5nIGF1dGggc2Vzc2lvbjonLCBzZXNzaW9uRXJyb3IpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gY2F0Y2ggKHNlc3Npb25FcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwcm9jZXNzaW5nIGF1dGggc2Vzc2lvbjonLCBzZXNzaW9uRXJyb3IpXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBEZWZhdWx0IHJlZGlyZWN0IHRvIHRoZSBuZXh0IFVSTCBvciBob21lIHBhZ2VcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KGAke29yaWdpbn0ke25leHR9YClcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignVW5leHBlY3RlZCBlcnJvciBpbiBkaXJlY3QgdG9rZW4gZmxvdzonLCBlcnJvcilcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChgJHtvcmlnaW59L2F1dGgvYXV0aC1jb2RlLWVycm9yYClcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGlmIChjb2RlKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zb2xlLmxvZygn8J+UhCBQcm9jZXNzaW5nIGF1dGggY29kZTonLCBjb2RlLnN1YnN0cmluZygwLCAxMCkgKyAnLi4uJylcclxuICAgICAgY29uc29sZS5sb2coJ/CflIQgU2VydmVyIHRpbWU6JywgbmV3IERhdGUoKS50b0lTT1N0cmluZygpKVxyXG4gICAgICBcclxuICAgICAgLy8gQ3JlYXRlIGEgc2VydmVyLXNpZGUgU3VwYWJhc2UgY2xpZW50XHJcbiAgICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KFxyXG4gICAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXHJcbiAgICAgICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkhXHJcbiAgICAgIClcclxuXHJcbiAgICAgIC8vIEV4Y2hhbmdlIHRoZSBjb2RlIGZvciBhIHNlc3Npb25cclxuICAgICAgY29uc29sZS5sb2coJ/CflIQgQXR0ZW1wdGluZyB0byBleGNoYW5nZSBjb2RlIGZvciBzZXNzaW9uLi4uJylcclxuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5leGNoYW5nZUNvZGVGb3JTZXNzaW9uKGNvZGUpXHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZygn8J+UhCBFeGNoYW5nZSByZXN1bHQ6Jywge1xyXG4gICAgICAgIGhhc0RhdGE6ICEhZGF0YSxcclxuICAgICAgICBoYXNTZXNzaW9uOiAhIWRhdGE/LnNlc3Npb24sXHJcbiAgICAgICAgaGFzVXNlcjogISFkYXRhPy51c2VyLFxyXG4gICAgICAgIGVycm9yOiBlcnJvciA/IHtcclxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgICAgICBzdGF0dXM6IGVycm9yLnN0YXR1cyxcclxuICAgICAgICAgIG5hbWU6IGVycm9yLm5hbWVcclxuICAgICAgICB9IDogbnVsbFxyXG4gICAgICB9KVxyXG4gICAgICBcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcign8J+UhCBEZXRhaWxlZCBlcnJvciBleGNoYW5naW5nIGNvZGUgZm9yIHNlc3Npb246Jywge1xyXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIHN0YXR1czogZXJyb3Iuc3RhdHVzLFxyXG4gICAgICAgICAgbmFtZTogZXJyb3IubmFtZSxcclxuICAgICAgICAgIHN0YWNrOiBlcnJvci5zdGFja1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChgJHtvcmlnaW59L2F1dGgvYXV0aC1jb2RlLWVycm9yP2Vycm9yPWV4Y2hhbmdlX2ZhaWxlZCZtZXNzYWdlPSR7ZW5jb2RlVVJJQ29tcG9uZW50KGVycm9yLm1lc3NhZ2UpfWApXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChkYXRhLnNlc3Npb24pIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnU3VjY2Vzc2Z1bGx5IGF1dGhlbnRpY2F0ZWQgdXNlcjonLCBkYXRhLnVzZXI/LmVtYWlsKVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIENyZWF0ZSB1c2VyIHByb2ZpbGUgaWYgaXQgZG9lc24ndCBleGlzdFxyXG4gICAgICAgIGlmIChkYXRhLnVzZXIpIHtcclxuICAgICAgICAgIGNvbnN0IHsgZXJyb3I6IHByb2ZpbGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgICAgLmZyb20oJ3VzZXJfcHJvZmlsZXMnKVxyXG4gICAgICAgICAgICAudXBzZXJ0KHtcclxuICAgICAgICAgICAgICBpZDogZGF0YS51c2VyLmlkLFxyXG4gICAgICAgICAgICAgIGVtYWlsOiBkYXRhLnVzZXIuZW1haWwgfHwgbnVsbCxcclxuICAgICAgICAgICAgICBmdWxsX25hbWU6IGRhdGEudXNlci51c2VyX21ldGFkYXRhPy5mdWxsX25hbWUgfHwgbnVsbCxcclxuICAgICAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgIG9uQ29uZmxpY3Q6ICdpZCdcclxuICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICBpZiAocHJvZmlsZUVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nL3VwZGF0aW5nIHVzZXIgcHJvZmlsZTonLCBwcm9maWxlRXJyb3IpXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDaGVjayBpZiB0aGlzIGlzIHBhcnQgb2YgYSBjcm9zcy1hcHBsaWNhdGlvbiBhdXRoZW50aWNhdGlvbiBmbG93XHJcbiAgICAgICAgaWYgKHNlc3Npb25Ub2tlbikge1xyXG4gICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgLy8gQ29tcGxldGUgdGhlIGF1dGggc2Vzc2lvbiBhbmQgZ2V0IHJlZGlyZWN0IGluZm9ybWF0aW9uXHJcbiAgICAgICAgICAgIGNvbnN0IHsgZGF0YTogc2Vzc2lvbkRhdGEsIGVycm9yOiBzZXNzaW9uRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnJwYygnY29tcGxldGVfYXV0aF9zZXNzaW9uJywge1xyXG4gICAgICAgICAgICAgIHNlc3Npb25fdG9rZW46IHNlc3Npb25Ub2tlbixcclxuICAgICAgICAgICAgICBhdXRoZW50aWNhdGVkX3VzZXJfaWQ6IGRhdGEudXNlci5pZFxyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgaWYgKCFzZXNzaW9uRXJyb3IgJiYgc2Vzc2lvbkRhdGEgJiYgc2Vzc2lvbkRhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgIGNvbnN0IHsgcmVkaXJlY3RfdXJsLCBzdGF0ZSB9ID0gc2Vzc2lvbkRhdGFbMF1cclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+OryBSZXRyaWV2ZWQgcmVkaXJlY3RfdXJsIGZyb20gc2Vzc2lvbjonLCByZWRpcmVjdF91cmwpXHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/Cfjq8gcmVkaXJlY3RfdXJsIGxlbmd0aDonLCByZWRpcmVjdF91cmwubGVuZ3RoKVxyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgIC8vIEJ1aWxkIHRoZSByZWRpcmVjdCBVUkwgd2l0aCBzdWNjZXNzIHBhcmFtZXRlcnNcclxuICAgICAgICAgICAgICBjb25zdCByZWRpcmVjdFVybCA9IG5ldyBVUkwocmVkaXJlY3RfdXJsKVxyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5SXIEJhc2UgcmVkaXJlY3RVcmwgY3JlYXRlZDonLCByZWRpcmVjdFVybC50b1N0cmluZygpKVxyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgIHJlZGlyZWN0VXJsLnNlYXJjaFBhcmFtcy5zZXQoJ2F1dGhfc3VjY2VzcycsICd0cnVlJylcclxuICAgICAgICAgICAgICByZWRpcmVjdFVybC5zZWFyY2hQYXJhbXMuc2V0KCd1c2VyX2lkJywgZGF0YS51c2VyLmlkKVxyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5SXIEFmdGVyIGFkZGluZyBhdXRoX3N1Y2Nlc3MgYW5kIHVzZXJfaWQ6JywgcmVkaXJlY3RVcmwudG9TdHJpbmcoKSlcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+UlyBDdXJyZW50IGxlbmd0aDonLCByZWRpcmVjdFVybC50b1N0cmluZygpLmxlbmd0aClcclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICBpZiAoc3RhdGUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn46vIEFkZGluZyBzdGF0ZTonLCBKU09OLnN0cmluZ2lmeShzdGF0ZSkpXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+OryBTdGF0ZSBsZW5ndGg6JywgSlNPTi5zdHJpbmdpZnkoc3RhdGUpLmxlbmd0aClcclxuICAgICAgICAgICAgICAgIHJlZGlyZWN0VXJsLnNlYXJjaFBhcmFtcy5zZXQoJ3N0YXRlJywgSlNPTi5zdHJpbmdpZnkoc3RhdGUpKVxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/CflJcgQWZ0ZXIgYWRkaW5nIHN0YXRlOicsIHJlZGlyZWN0VXJsLnRvU3RyaW5nKCkpXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+UlyBGaW5hbCBsZW5ndGg6JywgcmVkaXJlY3RVcmwudG9TdHJpbmcoKS5sZW5ndGgpXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIENoZWNrIGZvciBwb3RlbnRpYWwgVVJMIGxlbmd0aCBpc3N1ZXNcclxuICAgICAgICAgICAgICAgIGlmIChyZWRpcmVjdFVybC50b1N0cmluZygpLmxlbmd0aCA+IDIwNDgpIHtcclxuICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gV0FSTklORzogRmluYWwgcmVkaXJlY3RVcmwgZXhjZWVkcyAyMDQ4IGNoYXJhY3RlcnMsIG1heSBjYXVzZSBpc3N1ZXMgd2l0aCBzb21lIGJyb3dzZXJzL2VtYWlsIGNsaWVudHMnKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHJlZGlyZWN0VXJsLnRvU3RyaW5nKCkubGVuZ3RoID4gODE5Mikge1xyXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRVJST1I6IEZpbmFsIHJlZGlyZWN0VXJsIGV4Y2VlZHMgODE5MiBjaGFyYWN0ZXJzLCBsaWtlbHkgdG8gY2F1c2UgZmFpbHVyZXMnKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/CfmoAgRmluYWwgcmVkaXJlY3QgVVJMOicsIHJlZGlyZWN0VXJsLnRvU3RyaW5nKCkpXHJcbiAgICAgICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChyZWRpcmVjdFVybC50b1N0cmluZygpKVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNvbXBsZXRpbmcgYXV0aCBzZXNzaW9uOicsIHNlc3Npb25FcnJvcilcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBjYXRjaCAoc2Vzc2lvbkVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHByb2Nlc3NpbmcgYXV0aCBzZXNzaW9uOicsIHNlc3Npb25FcnJvcilcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIERlZmF1bHQgcmVkaXJlY3QgdG8gdGhlIG5leHQgVVJMIG9yIGhvbWUgcGFnZVxyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QoYCR7b3JpZ2lufSR7bmV4dH1gKVxyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdVbmV4cGVjdGVkIGVycm9yIGluIGF1dGggY2FsbGJhY2s6JywgZXJyb3IpXHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QoYCR7b3JpZ2lufS9hdXRoL2F1dGgtY29kZS1lcnJvcmApXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBJZiBubyBjb2RlLCByZWRpcmVjdCB0byBob21lXHJcbiAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChgJHtvcmlnaW59L2ApXHJcbn0iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiY3JlYXRlQ2xpZW50IiwiR0VUIiwicmVxdWVzdCIsInNlYXJjaFBhcmFtcyIsIm9yaWdpbiIsImhhc2giLCJVUkwiLCJ1cmwiLCJjb2RlIiwiZ2V0Iiwic2Vzc2lvblRva2VuIiwibmV4dCIsImVycm9yIiwiZXJyb3JDb2RlIiwiZXJyb3JEZXNjcmlwdGlvbiIsImFjY2Vzc1Rva2VuIiwicmVmcmVzaFRva2VuIiwidG9rZW5UeXBlIiwiZXhwaXJlc0F0IiwidHlwZSIsImNvbnNvbGUiLCJsb2ciLCJsZW5ndGgiLCJyZWRpcmVjdCIsImVuY29kZVVSSUNvbXBvbmVudCIsInN1cGFiYXNlIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiZGF0YSIsInNlc3Npb25FcnJvciIsImF1dGgiLCJzZXRTZXNzaW9uIiwiYWNjZXNzX3Rva2VuIiwicmVmcmVzaF90b2tlbiIsImhhc0RhdGEiLCJoYXNTZXNzaW9uIiwic2Vzc2lvbiIsImhhc1VzZXIiLCJ1c2VyIiwibWVzc2FnZSIsInN0YXR1cyIsImVtYWlsIiwicHJvZmlsZUVycm9yIiwiZnJvbSIsInVwc2VydCIsImlkIiwiZnVsbF9uYW1lIiwidXNlcl9tZXRhZGF0YSIsInVwZGF0ZWRfYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJvbkNvbmZsaWN0Iiwic2Vzc2lvbkRhdGEiLCJycGMiLCJzZXNzaW9uX3Rva2VuIiwiYXV0aGVudGljYXRlZF91c2VyX2lkIiwicmVkaXJlY3RfdXJsIiwic3RhdGUiLCJyZWRpcmVjdFVybCIsInRvU3RyaW5nIiwic2V0IiwiSlNPTiIsInN0cmluZ2lmeSIsIndhcm4iLCJzdWJzdHJpbmciLCJleGNoYW5nZUNvZGVGb3JTZXNzaW9uIiwibmFtZSIsInN0YWNrIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/auth/callback/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fauth%2Fcallback%2Froute&page=%2Fauth%2Fcallback%2Froute&appPaths=&pagePath=private-next-app-dir%2Fauth%2Fcallback%2Froute.ts&appDir=C%3A%5CRepos%5CMrBrooksAuthServices%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CRepos%5CMrBrooksAuthServices&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();